CREATE DATABASE beverage_shop;

CREATE TABLE USERS(
    u_id INT AUTO_INCREMENT,
    email VARCHAR(50) UNIQUE,
    u_name VARCHAR(50) UNIQUE,
    password VARCHAR(256) NOT NULL,
    type VARCHAR(8) NOT NULL,
    
    PRIMARY KEY(u_id)
);

CREATE TABLE CUSTOMER(
    u_id INT,
    c_name VARCHAR(50),
    c_phone VARCHAR(10) UNIQUE,
    
    PRIMARY KEY(u_id),
    FOREIGN KEY(u_id) REFERENCES USERS(u_id)
);

CREATE TABLE MERCHANT(
    u_id INT,
    m_name VARCHAR(50),
    m_phone VARCHAR(10) UNIQUE,
    menu VARCHAR(50),
    opening_hours DATETIME,
    delivery CHAR(1),
    address_city VARCHAR(10),
    address_district VARCHAR(10),
    address_detail VARCHAR(10),
    manager_name VARCHAR(50),
    manager_phone VARCHAR(10),
    
    PRIMARY KEY(u_id),
    FOREIGN KEY(u_id) REFERENCES users(u_id)
);

CREATE TABLE ORDERS(
    o_id CHAR(6) UNIQUE,
    c_id INT,
    m_id INT,
    order_time DATETIME,
    is_accepted CHAR(1),
    accept_time DATETIME,
    is_canceled CHAR(1),
    cancel_time DATETIME,
    
    PRIMARY KEY(c_id, m_id),
    FOREIGN KEY(c_id) REFERENCES customer(u_id),
    FOREIGN KEY(m_id) REFERENCES merchant(u_id)
);

CREATE TABLE BEVERAGE(
    b_id INT AUTO_INCREMENT,
    o_id CHAR(6) UNIQUE,
    b_name VARCHAR(50) NOT NULL,
    quantity INT NOT NULL,
    
    PRIMARY KEY(b_id, o_id),
    FOREIGN KEY(o_id) REFERENCES orders(o_id)
);

CREATE TABLE COMMENTS(
    m_id INT,
    c_id INT,
    stars INT,
    content TEXT,
    time DATETIME,
    
    PRIMARY KEY(m_id, c_id, time),
    FOREIGN KEY(m_id) REFERENCES merchant(u_id),
    FOREIGN KEY(c_id) REFERENCES customer(u_id)
);

CREATE TABLE ANNOUNCEMENT(
    a_id INT,
    m_id INT,
    title VARCHAR(50),
    content TEXT NOT NULL,
    time DATETIME NOT NULL,
    
    PRIMARY KEY(a_id, m_id),
    FOREIGN KEY(m_id) REFERENCES merchant(u_id)
);