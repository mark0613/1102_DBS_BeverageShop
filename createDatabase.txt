CREATE DATABASE beverage_shop;

CREATE TABLE USERS(
    U_Id INT NOT NULL AUTO_INCREMENT,
    Email VARCHAR(30) NOT NULL,
    U_Name VARCHAR(30) NOT NULL,
    Password VARCHAR(256) NOT NULL,
    Type VARCHAR(8) NOT NULL,
    
    PRIMARY KEY(U_Id)
);

CREATE TABLE CUSTOMER(
    C_Id INT NOT NULL AUTO_INCREMENT,
    U_Id INT NOT NULL UNIQUE,
    C_Name VARCHAR(30) NOT NULL,
    C_Phone VARCHAR(10) UNIQUE,
    
    PRIMARY KEY(C_Id),
    FOREIGN KEY(U_Id) REFERENCES USERS(U_Id)
);

CREATE TABLE MERCHANT(
    M_Id INT NOT NULL AUTO_INCREMENT,
    U_Id INT NOT NULL,
    M_Name VARCHAR(30) NOT NULL,
    M_Phone VARCHAR(10),
    Menu VARCHAR(30),
    OpeningHours DATE,
    Delivery CHAR(1) NOT NULL,
    AddressCity VARCHAR(10),
    AddressDistrict VARCHAR(10),
    AddressDetail VARCHAR(10),
    ManagerName VARCHAR(30),
    ManagerPhone VARCHAR(10),
    
    PRIMARY KEY(M_Id),
    FOREIGN KEY(U_Id) REFERENCES users(U_Id)
);

CREATE TABLE ORDERS(
    O_Id CHAR(6) NOT NULL UNIQUE,
    C_Id INT NOT NULL,
    M_Id INT NOT NULL,
    OrderTime DATE NOT NULL,
    IsAccepted CHAR(1) NOT NULL,
    AcceptTime DATE,
    IsCanceled CHAR(1) NOT NULL,
    CancelTime DATE,
    
    PRIMARY KEY(C_Id, M_Id),
    FOREIGN KEY(C_Id) REFERENCES customer(C_Id),
    FOREIGN KEY(M_Id) REFERENCES merchant(M_id)
);

CREATE TABLE BEVERAGE(
    B_Id INT NOT NULL AUTO_INCREMENT,
    O_Id CHAR(6) NOT NULL,
    B_Name VARCHAR(30) NOT NULL,
    Quantity INT NOT NULL,
    
    PRIMARY KEY(B_Id, O_Id),
    FOREIGN KEY(O_Id) REFERENCES orders(O_Id)
);

CREATE TABLE COMMENTS(
    M_Id INT NOT NULL,
    C_Id INT NOT NULL,
    Stars INT,
    Content TEXT,
    Time DATE NOT NULL,
    
    PRIMARY KEY(M_Id, C_Id, Time),
    FOREIGN KEY(M_Id) REFERENCES merchant(M_Id),
    FOREIGN KEY(C_Id) REFERENCES customer(C_Id)
);

CREATE TABLE ANNOUNCEMENT(
    A_Id INT NOT NULL,
    M_Id INT NOT NULL,
    Title VARCHAR(30) NOT NULL UNIQUE,
    Content TEXT NOT NULL,
    Time Date NOT NULL,
    
    PRIMARY KEY(A_Id, M_Id),
    FOREIGN KEY(M_Id) REFERENCES merchant(M_Id)
);